databaseChangeLog:
  - changeSet:
      id: spring-batch-core-tables-and-sequences
      author: hamdi
      changes:

        # ==== SEQUENCES SPRING BATCH =========================================
        - createSequence:
            sequenceName: BATCH_STEP_EXECUTION_SEQ
            maxValue: 9223372036854775807
            cycle: false

        - createSequence:
            sequenceName: BATCH_JOB_EXECUTION_SEQ
            maxValue: 9223372036854775807
            cycle: false

        - createSequence:
            sequenceName: BATCH_JOB_SEQ
            maxValue: 9223372036854775807
            cycle: false

        # ==== BATCH_JOB_INSTANCE =============================================
        - createTable:
            tableName: BATCH_JOB_INSTANCE
            columns:
              - column:
                  name: JOB_INSTANCE_ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: VERSION
                  type: BIGINT
              - column:
                  name: JOB_NAME
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: JOB_KEY
                  type: VARCHAR(32)
                  constraints:
                    nullable: false

        - createIndex:
            tableName: BATCH_JOB_INSTANCE
            indexName: JOB_INST_UN
            unique: true
            columns:
              - column:
                  name: JOB_NAME
              - column:
                  name: JOB_KEY

        # ==== BATCH_JOB_EXECUTION ============================================
        - createTable:
            tableName: BATCH_JOB_EXECUTION
            columns:
              - column:
                  name: JOB_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: VERSION
                  type: BIGINT
              - column:
                  name: JOB_INSTANCE_ID
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: CREATE_TIME
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: START_TIME
                  type: TIMESTAMP
              - column:
                  name: END_TIME
                  type: TIMESTAMP
              - column:
                  name: STATUS
                  type: VARCHAR(10)
              - column:
                  name: EXIT_CODE
                  type: VARCHAR(2500)
              - column:
                  name: EXIT_MESSAGE
                  type: VARCHAR(2500)
              - column:
                  name: LAST_UPDATED
                  type: TIMESTAMP
              - column:
                  name: JOB_CONFIGURATION_LOCATION
                  type: VARCHAR(2500)

        - addForeignKeyConstraint:
            baseTableName: BATCH_JOB_EXECUTION
            baseColumnNames: JOB_INSTANCE_ID
            referencedTableName: BATCH_JOB_INSTANCE
            referencedColumnNames: JOB_INSTANCE_ID
            constraintName: JOB_INST_EXEC_FK

        # ==== BATCH_JOB_EXECUTION_PARAMS =====================================
        - createTable:
            tableName: BATCH_JOB_EXECUTION_PARAMS
            columns:
              - column:
                  name: JOB_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: TYPE_CD
                  type: VARCHAR(6)
                  constraints:
                    nullable: false
              - column:
                  name: KEY_NAME
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: STRING_VAL
                  type: VARCHAR(250)
              - column:
                  name: DATE_VAL
                  type: TIMESTAMP
              - column:
                  name: LONG_VAL
                  type: BIGINT
              - column:
                  name: DOUBLE_VAL
                  type: DOUBLE PRECISION
              - column:
                  name: IDENTIFYING
                  type: CHAR(1)
                  constraints:
                    nullable: false

        - addForeignKeyConstraint:
            baseTableName: BATCH_JOB_EXECUTION_PARAMS
            baseColumnNames: JOB_EXECUTION_ID
            referencedTableName: BATCH_JOB_EXECUTION
            referencedColumnNames: JOB_EXECUTION_ID
            constraintName: JOB_EXEC_PARAMS_FK

        # ==== BATCH_STEP_EXECUTION ===========================================
        - createTable:
            tableName: BATCH_STEP_EXECUTION
            columns:
              - column:
                  name: STEP_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: VERSION
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: STEP_NAME
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: JOB_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: START_TIME
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: END_TIME
                  type: TIMESTAMP
              - column:
                  name: STATUS
                  type: VARCHAR(10)
              - column:
                  name: COMMIT_COUNT
                  type: BIGINT
              - column:
                  name: READ_COUNT
                  type: BIGINT
              - column:
                  name: FILTER_COUNT
                  type: BIGINT
              - column:
                  name: WRITE_COUNT
                  type: BIGINT
              - column:
                  name: READ_SKIP_COUNT
                  type: BIGINT
              - column:
                  name: WRITE_SKIP_COUNT
                  type: BIGINT
              - column:
                  name: PROCESS_SKIP_COUNT
                  type: BIGINT
              - column:
                  name: ROLLBACK_COUNT
                  type: BIGINT
              - column:
                  name: EXIT_CODE
                  type: VARCHAR(2500)
              - column:
                  name: EXIT_MESSAGE
                  type: VARCHAR(2500)
              - column:
                  name: LAST_UPDATED
                  type: TIMESTAMP

        - addForeignKeyConstraint:
            baseTableName: BATCH_STEP_EXECUTION
            baseColumnNames: JOB_EXECUTION_ID
            referencedTableName: BATCH_JOB_EXECUTION
            referencedColumnNames: JOB_EXECUTION_ID
            constraintName: JOB_EXEC_STEP_FK

        # ==== BATCH_STEP_EXECUTION_CONTEXT ====================================
        - createTable:
            tableName: BATCH_STEP_EXECUTION_CONTEXT
            columns:
              - column:
                  name: STEP_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: SHORT_CONTEXT
                  type: VARCHAR(2500)
                  constraints:
                    nullable: false
              - column:
                  name: SERIALIZED_CONTEXT
                  type: TEXT

        - addForeignKeyConstraint:
            baseTableName: BATCH_STEP_EXECUTION_CONTEXT
            baseColumnNames: STEP_EXECUTION_ID
            referencedTableName: BATCH_STEP_EXECUTION
            referencedColumnNames: STEP_EXECUTION_ID
            constraintName: STEP_EXEC_CTX_FK

        # ==== BATCH_JOB_EXECUTION_CONTEXT =====================================
        - createTable:
            tableName: BATCH_JOB_EXECUTION_CONTEXT
            columns:
              - column:
                  name: JOB_EXECUTION_ID
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: SHORT_CONTEXT
                  type: VARCHAR(2500)
                  constraints:
                    nullable: false
              - column:
                  name: SERIALIZED_CONTEXT
                  type: TEXT

        - addForeignKeyConstraint:
            baseTableName: BATCH_JOB_EXECUTION_CONTEXT
            baseColumnNames: JOB_EXECUTION_ID
            referencedTableName: BATCH_JOB_EXECUTION
            referencedColumnNames: JOB_EXECUTION_ID
            constraintName: JOB_EXEC_CTX_FK
